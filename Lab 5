import React, { useEffect, useState } from 'react';
import {
Â  View,
Â  Text,
Â  TextInput,
Â  FlatList,
Â  Alert,
Â  TouchableOpacity,
Â  StyleSheet,
Â  ScrollView,
Â  Button,
Â  SafeAreaView,
Â  KeyboardAvoidingView,
Â  Platform,
Â  Dimensions,
} from 'react-native';
import * as FileSystem from 'expo-file-system';

const rootDir = FileSystem.documentDirectory;
const screenWidth = Dimensions.get('window').width;

export default function App() {
Â  const [currentPath, setCurrentPath] = useState(rootDir);
Â  const [items, setItems] = useState([]);
Â  const [fileName, setFileName] = useState('');
Â  const [fileContent, setFileContent] = useState('');
Â  const [editMode, setEditMode] = useState(false);
Â  const [currentFile, setCurrentFile] = useState(null);
Â  const [showFileEditor, setShowFileEditor] = useState(false);
Â  const [freeSpace, setFreeSpace] = useState(null);
Â  const [totalSpace, setTotalSpace] = useState(null);

Â  useEffect(() => {
Â  Â  loadFiles();
Â  Â  loadDiskInfo();
Â  }, [currentPath]);

Â  const loadDiskInfo = async () => {
Â  Â  const free = await FileSystem.getFreeDiskStorageAsync();
Â  Â  const total = await FileSystem.getTotalDiskCapacityAsync();
Â  Â  setFreeSpace(free);
Â  Â  setTotalSpace(total);
Â  };

Â  const loadFiles = async () => {
Â  Â  try {
Â  Â  Â  const list = await FileSystem.readDirectoryAsync(currentPath);
Â  Â  Â  const detailedList = await Promise.all(
Â  Â  Â  Â  list.map(async (name) => {
Â  Â  Â  Â  Â  const info = await FileSystem.getInfoAsync(currentPath + name);
Â  Â  Â  Â  Â  return { name, ...info };
Â  Â  Â  Â  })
Â  Â  Â  );
Â  Â  Â  setItems(detailedList);
Â  Â  Â  setShowFileEditor(false);
Â  Â  Â  setFileName('');
Â  Â  Â  setFileContent('');
Â  Â  Â  setEditMode(false);
Â  Â  Â  setCurrentFile(null);
Â  Â  } catch (e) {
Â  Â  Â  Alert.alert('ĞŸĞ¾Ğ¼Ğ¸Ğ»ĞºĞ°', 'ĞĞµ Ğ²Ğ´Ğ°Ğ»Ğ¾ÑÑ Ğ¿Ñ€Ğ¾Ñ‡Ğ¸Ñ‚Ğ°Ñ‚Ğ¸ ĞºĞ°Ñ‚Ğ°Ğ»Ğ¾Ğ³');
Â  Â  }
Â  };

Â  const openFolder = (name) => {
Â  Â  setCurrentPath(currentPath + name + '/');
Â  };

Â  const goBack = () => {
Â  Â  if (currentPath === rootDir) return;
Â  Â  const parts = currentPath.split('/').filter(Boolean);
Â  Â  parts.pop();
Â  Â  const newPath = parts.length ? parts.join('/') + '/' : rootDir;
Â  Â  setCurrentPath(newPath);
Â  };

Â  const createFolder = async () => {
Â  Â  if (!fileName) {
Â  Â  Â  Alert.alert('ĞŸĞ¾Ğ¼Ğ¸Ğ»ĞºĞ°', 'Ğ’Ğ²ĞµĞ´Ñ–Ñ‚ÑŒ Ğ½Ğ°Ğ·Ğ²Ñƒ Ğ¿Ğ°Ğ¿ĞºĞ¸');
Â  Â  Â  return;
Â  Â  }
Â  Â  try {
Â  Â  Â  await FileSystem.makeDirectoryAsync(currentPath + fileName);
Â  Â  Â  setFileName('');
Â  Â  Â  loadFiles();
Â  Â  } catch (e) {
Â  Â  Â  Alert.alert('ĞŸĞ¾Ğ¼Ğ¸Ğ»ĞºĞ°', 'ĞĞµ Ğ²Ğ´Ğ°Ğ»Ğ¾ÑÑ ÑÑ‚Ğ²Ğ¾Ñ€Ğ¸Ñ‚Ğ¸ Ğ¿Ğ°Ğ¿ĞºÑƒ');
Â  Â  }
Â  };

Â  const createFile = async () => {
Â  Â  if (!fileName.endsWith('.txt')) {
Â  Â  Â  Alert.alert('ĞŸĞ¾Ğ¼Ğ¸Ğ»ĞºĞ°', 'Ğ¤Ğ°Ğ¹Ğ» Ğ¿Ğ¾Ğ²Ğ¸Ğ½ĞµĞ½ Ğ¼Ğ°Ñ‚Ğ¸ Ñ€Ğ¾Ğ·ÑˆĞ¸Ñ€ĞµĞ½Ğ½Ñ .txt');
Â  Â  Â  return;
Â  Â  }
Â  Â  try {
Â  Â  Â  await FileSystem.writeAsStringAsync(currentPath + fileName, fileContent);
Â  Â  Â  setFileName('');
Â  Â  Â  setFileContent('');
Â  Â  Â  loadFiles();
Â  Â  } catch (e) {
Â  Â  Â  Alert.alert('ĞŸĞ¾Ğ¼Ğ¸Ğ»ĞºĞ°', 'ĞĞµ Ğ²Ğ´Ğ°Ğ»Ğ¾ÑÑ ÑÑ‚Ğ²Ğ¾Ñ€Ğ¸Ñ‚Ğ¸ Ñ„Ğ°Ğ¹Ğ»');
Â  Â  }
Â  };

Â  const readFile = async (name) => {
Â  Â  try {
Â  Â  Â  const content = await FileSystem.readAsStringAsync(currentPath + name);
Â  Â  Â  setFileContent(content);
Â  Â  Â  setFileName(name);
Â  Â  Â  setEditMode(true);
Â  Â  Â  setCurrentFile(name);
Â  Â  Â  setShowFileEditor(true);
Â  Â  } catch (e) {
Â  Â  Â  Alert.alert('ĞŸĞ¾Ğ¼Ğ¸Ğ»ĞºĞ°', 'ĞĞµ Ğ²Ğ´Ğ°Ğ»Ğ¾ÑÑ Ğ²Ñ–Ğ´ĞºÑ€Ğ¸Ñ‚Ğ¸ Ñ„Ğ°Ğ¹Ğ»');
Â  Â  }
Â  };

Â  const saveEdit = async () => {
Â  Â  try {
Â  Â  Â  await FileSystem.writeAsStringAsync(currentPath + currentFile, fileContent);
Â  Â  Â  setEditMode(false);
Â  Â  Â  setCurrentFile(null);
Â  Â  Â  setFileContent('');
Â  Â  Â  setFileName('');
Â  Â  Â  setShowFileEditor(false);
Â  Â  Â  loadFiles();
Â  Â  } catch (e) {
Â  Â  Â  Alert.alert('ĞŸĞ¾Ğ¼Ğ¸Ğ»ĞºĞ°', 'ĞĞµ Ğ²Ğ´Ğ°Ğ»Ğ¾ÑÑ Ğ·Ğ±ĞµÑ€ĞµĞ³Ñ‚Ğ¸ Ñ„Ğ°Ğ¹Ğ»');
Â  Â  }
Â  };

Â  const deleteItem = async (name, isDirectory) => {
Â  Â  Alert.alert('Ğ’Ğ¸Ğ´Ğ°Ğ»Ğ¸Ñ‚Ğ¸?', name, [
Â  Â  Â  { text: 'Ğ¡ĞºĞ°ÑÑƒĞ²Ğ°Ñ‚Ğ¸', style: 'cancel' },
Â  Â  Â  {
Â  Â  Â  Â  text: 'Ğ’Ğ¸Ğ´Ğ°Ğ»Ğ¸Ñ‚Ğ¸',
Â  Â  Â  Â  style: 'destructive',
Â  Â  Â  Â  onPress: async () => {
Â  Â  Â  Â  Â  try {
Â  Â  Â  Â  Â  Â  await FileSystem.deleteAsync(currentPath + name, { idempotent: true });
Â  Â  Â  Â  Â  Â  loadFiles();
Â  Â  Â  Â  Â  } catch {
Â  Â  Â  Â  Â  Â  Alert.alert('ĞŸĞ¾Ğ¼Ğ¸Ğ»ĞºĞ°', 'ĞĞµ Ğ²Ğ´Ğ°Ğ»Ğ¾ÑÑ Ğ²Ğ¸Ğ´Ğ°Ğ»Ğ¸Ñ‚Ğ¸');
Â  Â  Â  Â  Â  }
Â  Â  Â  Â  },
Â  Â  Â  },
Â  Â  ]);
Â  };

Â  const renderItem = ({ item }) => (
Â  Â  <View style={styles.fileItem}>
Â  Â  Â  <TouchableOpacity
Â  Â  Â  Â  style={styles.fileNameWrap}
Â  Â  Â  Â  onPress={() => {
Â  Â  Â  Â  Â  if (item.isDirectory) {
Â  Â  Â  Â  Â  Â  openFolder(item.name);
Â  Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  readFile(item.name);
Â  Â  Â  Â  Â  }
Â  Â  Â  Â  }}
Â  Â  Â  >
Â  Â  Â  Â  <Text style={styles.fileName}>
Â  Â  Â  Â  Â  {item.isDirectory ? 'ğŸ“ ' : 'ğŸ“„ '}
Â  Â  Â  Â  Â  {item.name}
Â  Â  Â  Â  </Text>
Â  Â  Â  Â  <Text style={styles.fileInfo}>
Â  Â  Â  Â  Â  {item.size ? `Ğ Ğ¾Ğ·Ğ¼Ñ–Ñ€: ${item.size} Ğ±Ğ°Ğ¹Ñ‚` : ''}
Â  Â  Â  Â  Â  {' '}
Â  Â  Â  Â  Â  {item.modificationTime ? `| ĞÑÑ‚Ğ°Ğ½Ğ½Ñ” Ğ·Ğ¼Ñ–Ğ½ĞµĞ½Ğ½Ñ: ${new Date(item.modificationTime * 1000).toLocaleString()}` : ''}
Â  Â  Â  Â  </Text>
Â  Â  Â  </TouchableOpacity>
Â  Â  Â  <TouchableOpacity onPress={() => deleteItem(item.name, item.isDirectory)} style={styles.deleteButton}>
Â  Â  Â  Â  <Text style={{ fontSize: 18 }}>ğŸ—‘</Text>
Â  Â  Â  </TouchableOpacity>
Â  Â  </View>
Â  );

Â  return (
Â  Â  <SafeAreaView style={styles.safeArea}>
Â  Â  Â  <KeyboardAvoidingView
Â  Â  Â  Â  style={{ flex: 1 }}
Â  Â  Â  Â  behavior={Platform.OS === 'ios' ? 'padding' : 'height'}
Â  Â  Â  Â  keyboardVerticalOffset={Platform.OS === 'ios' ? 60 : 0}
Â  Â  Â  >
Â  Â  Â  Â  <>
Â  Â  Â  Â  Â  <ScrollView
Â  Â  Â  Â  Â  Â  contentContainerStyle={styles.scrollContainer}
Â  Â  Â  Â  Â  Â  keyboardShouldPersistTaps="handled"
Â  Â  Â  Â  Â  Â  showsVerticalScrollIndicator={false}
Â  Â  Â  Â  Â  >
Â  Â  Â  Â  Â  Â  <Text style={styles.header}>ğŸ“ Ğ¤Ğ°Ğ¹Ğ»Ğ¾Ğ²Ğ¸Ğ¹ ĞœĞµĞ½ĞµĞ´Ğ¶ĞµÑ€</Text>

Â  Â  Â  Â  Â  Â  <View style={styles.pathBar}>
Â  Â  Â  Â  Â  Â  Â  <Button title="â¬… ĞĞ°Ğ·Ğ°Ğ´" onPress={goBack} disabled={currentPath === rootDir} />
Â  Â  Â  Â  Â  Â  Â  <Text
Â  Â  Â  Â  Â  Â  Â  Â  style={styles.pathText}
Â  Â  Â  Â  Â  Â  Â  Â  numberOfLines={1}
Â  Â  Â  Â  Â  Â  Â  Â  ellipsizeMode="middle"
Â  Â  Â  Â  Â  Â  Â  >
Â  Â  Â  Â  Â  Â  Â  Â  {currentPath.replace(rootDir, '') || '/'}
Â  Â  Â  Â  Â  Â  Â  </Text>
Â  Â  Â  Â  Â  Â  </View>

Â  Â  Â  Â  Â  Â  {!showFileEditor && (
Â  Â  Â  Â  Â  Â  Â  <>
Â  Â  Â  Â  Â  Â  Â  Â  <TextInput
Â  Â  Â  Â  Â  Â  Â  Â  Â  placeholder="ĞĞ°Ğ·Ğ²Ğ° Ñ„Ğ°Ğ¹Ğ»Ñƒ Ğ°Ğ±Ğ¾ Ğ¿Ğ°Ğ¿ĞºĞ¸"
Â  Â  Â  Â  Â  Â  Â  Â  Â  value={fileName}
Â  Â  Â  Â  Â  Â  Â  Â  Â  onChangeText={setFileName}
Â  Â  Â  Â  Â  Â  Â  Â  Â  style={styles.input}
Â  Â  Â  Â  Â  Â  Â  Â  Â  textAlign="center"
Â  Â  Â  Â  Â  Â  Â  Â  Â  maxLength={50}
Â  Â  Â  Â  Â  Â  Â  Â  Â  autoCorrect={false}
Â  Â  Â  Â  Â  Â  Â  Â  Â  autoCapitalize="none"
Â  Â  Â  Â  Â  Â  Â  Â  />
Â  Â  Â  Â  Â  Â  Â  Â  <TextInput
Â  Â  Â  Â  Â  Â  Â  Â  Â  placeholder="Ğ’Ğ¼Ñ–ÑÑ‚ Ñ„Ğ°Ğ¹Ğ»Ñƒ (Ğ´Ğ»Ñ Ñ„Ğ°Ğ¹Ğ»Ñ–Ğ²)"
Â  Â  Â  Â  Â  Â  Â  Â  Â  value={fileContent}
Â  Â  Â  Â  Â  Â  Â  Â  Â  onChangeText={setFileContent}
Â  Â  Â  Â  Â  Â  Â  Â  Â  multiline
Â  Â  Â  Â  Â  Â  Â  Â  Â  style={[styles.textArea, { height: 100 }]}
Â  Â  Â  Â  Â  Â  Â  Â  Â  textAlignVertical="top"
Â  Â  Â  Â  Â  Â  Â  Â  />

Â  Â  Â  Â  Â  Â  Â  Â  <View style={styles.buttonsRow}>
Â  Â  Â  Â  Â  Â  Â  Â  Â  <TouchableOpacity style={styles.button} onPress={createFile}>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <Text style={styles.buttonText}>ğŸ“ Ğ¡Ñ‚Ğ²Ğ¾Ñ€Ğ¸Ñ‚Ğ¸ Ñ„Ğ°Ğ¹Ğ»</Text>
Â  Â  Â  Â  Â  Â  Â  Â  Â  </TouchableOpacity>
Â  Â  Â  Â  Â  Â  Â  Â  Â  <TouchableOpacity style={[styles.button, styles.folderButton]} onPress={createFolder}>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <Text style={styles.buttonText}>ğŸ“ Ğ¡Ñ‚Ğ²Ğ¾Ñ€Ğ¸Ñ‚Ğ¸ Ğ¿Ğ°Ğ¿ĞºÑƒ</Text>
Â  Â  Â  Â  Â  Â  Â  Â  Â  </TouchableOpacity>
Â  Â  Â  Â  Â  Â  Â  Â  </View>
Â  Â  Â  Â  Â  Â  Â  </>
Â  Â  Â  Â  Â  Â  )}

Â  Â  Â  Â  Â  Â  {showFileEditor && (
Â  Â  Â  Â  Â  Â  Â  <>
Â  Â  Â  Â  Â  Â  Â  Â  <Text style={styles.editingTitle}>Ğ ĞµĞ´Ğ°Ğ³ÑƒĞ²Ğ°Ğ½Ğ½Ñ Ñ„Ğ°Ğ¹Ğ»Ñƒ: {fileName}</Text>
Â  Â  Â  Â  Â  Â  Â  Â  <TextInput
Â  Â  Â  Â  Â  Â  Â  Â  Â  value={fileContent}
Â  Â  Â  Â  Â  Â  Â  Â  Â  onChangeText={setFileContent}
Â  Â  Â  Â  Â  Â  Â  Â  Â  multiline
Â  Â  Â  Â  Â  Â  Â  Â  Â  style={[styles.textArea, { height: 200 }]}
Â  Â  Â  Â  Â  Â  Â  Â  Â  textAlignVertical="top"
Â  Â  Â  Â  Â  Â  Â  Â  />
Â  Â  Â  Â  Â  Â  Â  Â  <View style={styles.buttonsRow}>
Â  Â  Â  Â  Â  Â  Â  Â  Â  <TouchableOpacity style={styles.button} onPress={saveEdit}>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <Text style={styles.buttonText}>ğŸ’¾ Ğ—Ğ±ĞµÑ€ĞµĞ³Ñ‚Ğ¸ Ğ·Ğ¼Ñ–Ğ½Ğ¸</Text>
Â  Â  Â  Â  Â  Â  Â  Â  Â  </TouchableOpacity>
Â  Â  Â  Â  Â  Â  Â  Â  Â  <TouchableOpacity style={[styles.button, styles.cancelButton]} onPress={() => setShowFileEditor(false)}>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <Text style={styles.buttonText}>âŒ Ğ’Ñ–Ğ´Ğ¼Ñ–Ğ½Ğ¸Ñ‚Ğ¸</Text>
Â  Â  Â  Â  Â  Â  Â  Â  Â  </TouchableOpacity>
Â  Â  Â  Â  Â  Â  Â  Â  </View>
Â  Â  Â  Â  Â  Â  Â  </>
Â  Â  Â  Â  Â  Â  )}

Â  Â  Â  Â  Â  Â  <Text style={styles.subHeader}>Ğ¡Ğ¿Ğ¸ÑĞ¾Ğº Ñ„Ğ°Ğ¹Ğ»Ñ–Ğ² Ñ‚Ğ° Ğ¿Ğ°Ğ¿Ğ¾Ğº:</Text>
Â  Â  Â  Â  Â  Â  <FlatList
Â  Â  Â  Â  Â  Â  Â  data={items}
Â  Â  Â  Â  Â  Â  Â  keyExtractor={(item) => item.name}
Â  Â  Â  Â  Â  Â  Â  renderItem={renderItem}
Â  Â  Â  Â  Â  Â  Â  contentContainerStyle={{ paddingBottom: 150 }}
Â  Â  Â  Â  Â  Â  Â  keyboardShouldPersistTaps="handled"
Â  Â  Â  Â  Â  Â  Â  style={{ width: '100%' }}
Â  Â  Â  Â  Â  Â  />
Â  Â  Â  Â  Â  </ScrollView>

Â  Â  Â  Â  Â  {/* Ğ¤Ñ–ĞºÑĞ¾Ğ²Ğ°Ğ½Ğ¸Ğ¹ Ğ±Ğ»Ğ¾Ğº Ñ–Ğ½Ñ„Ğ¾Ñ€Ğ¼Ğ°Ñ†Ñ–Ñ— Ğ¿Ñ€Ğ¾ Ğ¿Ğ°Ğ¼â€™ÑÑ‚ÑŒ */}
Â  Â  Â  Â  Â  <View style={styles.diskInfo}>
Â  Â  Â  Â  Â  Â  <Text>Ğ’Ñ–Ğ»ÑŒĞ½Ğµ Ğ¼Ñ–ÑÑ†Ğµ: {(freeSpace / (1024 * 1024)).toFixed(2)} MB</Text>
Â  Â  Â  Â  Â  Â  <Text>Ğ—Ğ°Ğ³Ğ°Ğ»ÑŒĞ½Ğ° Ğ¿Ğ°Ğ¼'ÑÑ‚ÑŒ: {(totalSpace / (1024 * 1024)).toFixed(2)} MB</Text>
Â  Â  Â  Â  Â  Â  <Text>Ğ’Ğ¸ĞºĞ¾Ñ€Ğ¸ÑÑ‚Ğ°Ğ½Ğ¾: {((totalSpace - freeSpace) / (1024 * 1024)).toFixed(2)} MB</Text>
Â  Â  Â  Â  Â  </View>
Â  Â  Â  Â  </>
Â  Â  Â  </KeyboardAvoidingView>
Â  Â  </SafeAreaView>
Â  );
}

const styles = StyleSheet.create({
Â  safeArea: { flex: 1, backgroundColor: '#fafafa' },
Â  scrollContainer: {
Â  Â  alignItems: 'center',
Â  Â  paddingBottom: 100,
Â  Â  paddingTop: 10,
Â  Â  width: '100%',
Â  },
Â  header: { fontSize: 28, fontWeight: 'bold', marginBottom: 20, color: '#333' },
Â  pathBar: {
Â  Â  flexDirection: 'row',
Â  Â  alignItems: 'center',
Â  Â  marginBottom: 10,
Â  Â  paddingHorizontal: 10,
Â  Â  width: screenWidth,
Â  },
Â  pathText: {
Â  Â  flex: 1,
Â  Â  marginLeft: 10,
Â  Â  fontSize: 16,
Â  Â  color: '#555',
Â  },
Â  input: {
Â  Â  width: '90%',
Â  Â  borderWidth: 1,
Â  Â  borderColor: '#bbb',
Â  Â  borderRadius: 8,
Â  Â  paddingHorizontal: 10,
Â  Â  paddingVertical: 8,
Â  Â  marginBottom: 10,
Â  Â  fontSize: 16,
Â  Â  backgroundColor: '#fff',
Â  },
Â  textArea: {
Â  Â  width: '90%',
Â  Â  borderWidth: 1,
Â  Â  borderColor: '#bbb',
Â  Â  borderRadius: 8,
Â  Â  paddingHorizontal: 10,
Â  Â  paddingVertical: 10,
Â  Â  backgroundColor: '#fff',
Â  Â  fontSize: 16,
Â  Â  marginBottom: 15,
Â  },
Â  buttonsRow: {
Â  Â  flexDirection: 'row',
Â  Â  justifyContent: 'space-around',
Â  Â  width: '90%',
Â  Â  marginBottom: 20,
Â  },
Â  button: {
Â  Â  backgroundColor: '#3b82f6',
Â  Â  paddingVertical: 12,
Â  Â  paddingHorizontal: 20,
Â  Â  borderRadius: 8,
Â  Â  minWidth: 140,
Â  },
Â  folderButton: {
Â  Â  backgroundColor: '#10b981',
Â  },
Â  cancelButton: {
Â  Â  backgroundColor: '#ef4444',
Â  },
Â  buttonText: { color: '#fff', fontWeight: '600', textAlign: 'center', fontSize: 16 },
Â  fileItem: {
Â  Â  flexDirection: 'row',
Â  Â  alignItems: 'center',
Â  Â  paddingHorizontal: 10,
Â  Â  paddingVertical: 12,
Â  Â  borderBottomWidth: 1,
Â  Â  borderBottomColor: '#eee',
Â  Â  width: screenWidth,
Â  },
Â  fileNameWrap: { flex: 1 },
Â  fileName: { fontSize: 18, color: '#222' },
Â  fileInfo: { fontSize: 12, color: '#666' },
Â  deleteButton: { paddingHorizontal: 15 },
Â  editingTitle: {
Â  Â  fontSize: 20,
Â  Â  marginBottom: 10,
Â  Â  fontWeight: '600',
Â  Â  color: '#111',
Â  },
Â  subHeader: {
Â  Â  fontSize: 20,
Â  Â  fontWeight: '600',
Â  Â  marginBottom: 10,
Â  Â  alignSelf: 'flex-start',
Â  Â  paddingLeft: 15,
Â  Â  color: '#222',
Â  },
Â  diskInfo: {
Â  Â  position: 'absolute',
Â  Â  bottom: 0,
Â  Â  width: '100%',
Â  Â  backgroundColor: '#eee',
Â  Â  paddingVertical: 12,
Â  Â  borderTopWidth: 1,
Â  Â  borderTopColor: '#ccc',
Â  Â  alignItems: 'center',
Â  },
});
